<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example: Optimization of the CADRE Roll Angle &mdash; CADRE 0.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="CADRE 0.4 documentation" href="index.html" />
    <link rel="next" title="Running the Full CADRE Problem" href="full.html" />
    <link rel="prev" title="Example: Optimization of the CADRE Orbital Parameters" href="launch.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="full.html" title="Running the Full CADRE Problem"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="launch.html" title="Example: Optimization of the CADRE Orbital Parameters"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">CADRE 0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="example-optimization-of-the-cadre-roll-angle">
<h1>Example: Optimization of the CADRE Roll Angle<a class="headerlink" href="#example-optimization-of-the-cadre-roll-angle" title="Permalink to this headline">Â¶</a></h1>
<p>In this example, we will optimize the roll angle of the CADRE satellite as it passes over the ground
station to maximize the gain of the communications system. This will demonstrate how to import the
full CADRE assembly to solve a closely related (but smaller) optimization problem. This
illustrates the flexibility of OpenMDAO&#8217;s problem graph and derivatives system with respect to
variations in problem formulation.</p>
<p>The communication system gain is computed as the output of the <tt class="docutils literal"><span class="pre">Comm_GainPattern()</span></tt> component, as
is an intermediate result in the full CADRE problem. For the sake of simplicity of the example, the
roll angle will be the only design variable considered.</p>
<p>The internal graph representation of this problem in OpenMDAO allows an optimization driver to
recognize that most of the components involved will never vary with respect to the roll angle. As a
result, these components will only run a single time, allowing for efficient optimization of this
smaller-scale design problem.</p>
<p>To begin, in a new Python file, we first import the libraries that we will use, which include (among
other things) the CADRE assembly, the standard OpenMDAO Component and Assembly classes, and the
SLSQP optimization driver.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openmdao.main.api</span> <span class="kn">import</span> <span class="n">Component</span>
<span class="kn">from</span> <span class="nn">openmdao.main.datatypes.api</span> <span class="kn">import</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Array</span>
<span class="kn">from</span> <span class="nn">CADRE</span> <span class="kn">import</span> <span class="n">CADRE</span>
<span class="kn">from</span> <span class="nn">openmdao.lib.drivers.api</span> <span class="kn">import</span> <span class="n">SLSQPdriver</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pylab</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>
</div>
<p>Now, we define an OpenMDAO component that computes the sum of an input array. We will use the output of this component as our objective function
later on.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NetGain</span><span class="p">(</span><span class="n">Component</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the sum of an inputted gain array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">net</span> <span class="o">=</span> <span class="n">Float</span><span class="p">(</span><span class="n">iotype</span><span class="o">=</span><span class="s">&quot;out&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NetGain</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;gain&#39;</span><span class="p">,</span> <span class="n">Array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">iotype</span><span class="o">=</span><span class="s">&#39;in&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,)))</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_derivT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;gain&#39;</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span> <span class="s">&#39;net&#39;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;gain&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">arg</span><span class="p">[</span><span class="s">&#39;net&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we create an instance of the CADRE base assembly and set appropriate
configuration data (starting position and velocity of the satellite, and number of days since
launch).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">150</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">CADRE</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="c"># orbit initial position and velocity</span>
<span class="n">r_e2b_I0</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">4969.91222</span><span class="p">,</span>  <span class="mf">4624.84149</span><span class="p">,</span>
            <span class="mf">1135.9414</span><span class="p">,</span>  <span class="mf">0.1874654</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.62801666</span><span class="p">,</span>  <span class="mf">7.4302362</span><span class="p">]</span>

<span class="c"># number of days since launch</span>
<span class="n">LD</span> <span class="o">=</span> <span class="mf">5417.5</span>

<span class="n">top</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;LD&quot;</span><span class="p">,</span> <span class="n">LD</span><span class="p">)</span>
<span class="n">top</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;r_e2b_I0&quot;</span><span class="p">,</span> <span class="n">r_e2b_I0</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the assembly &#8220;as is&#8221; gives us a baseline state of the model, with all design variables at
their default values. Our objective is to maximize the total communication gain (as computed by the
<tt class="docutils literal"><span class="pre">Comm_GainPattern()</span></tt> component in the CADRE assembly), so let&#8217;s get that value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Run model to get baseline net gain value</span>
<span class="n">top</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">obj1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">Comm_GainPattern</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Net comm gain before optimization:&quot;</span><span class="p">,</span> <span class="n">obj1</span>
</pre></div>
</div>
<p>Now we&#8217;re ready to optimize. Replace the default <tt class="docutils literal"><span class="pre">RunOnce</span></tt> driver with the <tt class="docutils literal"><span class="pre">SLSQPdriver()</span></tt>
optimization driver, add in the <tt class="docutils literal"><span class="pre">NetGain</span></tt> component, and configure the optimization problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Add in optimization driver</span>
<span class="n">top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;driver&quot;</span><span class="p">,</span> <span class="n">SLSQPdriver</span><span class="p">())</span>

<span class="n">top</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;NetGain&quot;</span><span class="p">,</span> <span class="n">NetGain</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">top</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;NetGain&quot;</span><span class="p">)</span>

<span class="n">top</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;Comm_GainPattern.gain&quot;</span><span class="p">,</span> <span class="s">&quot;NetGain.gain&quot;</span><span class="p">)</span>

<span class="n">top</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_parameter</span><span class="p">(</span><span class="s">&quot;CP_gamma&quot;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
<span class="n">top</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s">&quot;-NetGain.net&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Make a new two-plot figure, and in the first plot, graph the roll angles over time (the default
value being a single uniform value over time):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Roll angle $\gamma$, Before optimization&quot;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">CP_gamma</span><span class="p">)</span>
</pre></div>
</div>
<p>Run the assembly to perform the optimization and then record the new value of the gain:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">top</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">obj2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">Comm_GainPattern</span><span class="o">.</span><span class="n">gain</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Net comm gain before optimization:&quot;</span><span class="p">,</span> <span class="n">obj1</span>
<span class="k">print</span> <span class="s">&quot;Net comm gain after optimization:&quot;</span><span class="p">,</span> <span class="n">obj2</span>
</pre></div>
</div>
<p>Net comm gain before optimization: 900.205301576</p>
<p>Net comm gain after optimization: 1115.10921256</p>
<p>Now plot the roll angle again (but in the second subplot of the original figure) to visualize the
change in the roll angle, which is determined by the optimizer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;After&quot;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">CP_gamma</span><span class="p">)</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This gives us the figure:</p>
<a class="reference internal image-reference" href="_images/roll_results.png"><img alt="_images/roll_results.png" class="align-center" src="_images/roll_results.png" style="width: 850px;" /></a>
<p>This example is implemented in <tt class="docutils literal"><span class="pre">example_roll.py</span></tt>, in the top-level directory of the CADRE plugin repository, and can be run directly.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="launch.html"
                        title="previous chapter">Example: Optimization of the CADRE Orbital Parameters</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="full.html"
                        title="next chapter">Running the Full CADRE Problem</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/roll.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="full.html" title="Running the Full CADRE Problem"
             >next</a> |</li>
        <li class="right" >
          <a href="launch.html" title="Example: Optimization of the CADRE Orbital Parameters"
             >previous</a> |</li>
        <li><a href="index.html">CADRE 0.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright .
      Last updated on Feb 12, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
  </body>
</html>